# 架构蓝图：前端对接与 UI 建设（模块化）

## 1. 后端分层（已落地）

`api/` 目录采用分层设计：

1. 路由层：`api/routers/*.py`
- 按业务域拆分：`system/study/academic/grad/feed/daily/notify/scheduler/kb/tools`

2. 执行层：`api/executor.py`
- 统一调用 `skills.available_functions`
- 统一处理风险审批流（dry-run -> confirm）

3. 审批状态层：`api/approvals.py`
- 内存审批票据（TTL）
- 防止未确认直接执行高风险工具

4. 数据模型层：`api/models.py`
- 统一请求/响应结构，便于前端复用

## 2. 启动方式

- 终端对话（原模式）：`python run.py`
- 稳定性检查：`python run.py --health`
- 冒烟测试：`python run.py --smoke`
- API 服务：`python run_api.py --host 127.0.0.1 --port 8000`

## 3. 前端页面模块建议

1. `SystemDashboard`
- 健康检查、冒烟测试、最近调度运行

2. `StudyCenter`
- 知识库管理、考前包、讲解、学习计划

3. `AcademicWriter`
- 论文/邮件/推荐信/套磁信生成与修订

4. `GradDecision`
- 档案管理、联网检索、对比、评分卡、时间线

5. `InfoFlow`
- RSS、公众号桥接、摘要管道、任务建议

6. `PlannerNotify`
- Todo/Reminder、通知渠道、定时任务

## 4. UI 组件层建议

1. `ToolForm`
- 根据 schema 渲染输入（文本、数字、布尔、JSON）

2. `ResultPanel`
- 支持 Markdown、表格、JSON 折叠

3. `ApprovalDrawer`
- 显示 dry-run preview + 执行确认

4. `JobConsole`
- 展示长任务状态与日志

## 5. 审批交互标准

对高风险工具统一两段式：
1. 发起 dry-run：`approval.dry_run=true`
2. 获取 `approval_id` + `preview`
3. 用户确认后发起 confirm：
   - `approval.confirm=true`
   - `approval.approval_id=<id>`

## 6. 迭代建议（前端阶段）

1. 第一周：打通 System + Grad 两个模块（高价值路径）
2. 第二周：接入 Study + Notify
3. 第三周：接入 Feed + 调度可视化
4. 第四周：统一设计 token、主题、错误提示规范

